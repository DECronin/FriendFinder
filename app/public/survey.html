<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>FF Survey</title>
    <!-- <link rel="stylesheet" href="./style.css"> -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
</head>

<body>
    <header>Survey <a href="./home">Home</a></header>
    <form>
        <div class="user">
            <h1>User Details:</h1>
            Username:
            <input type="text" id="username"><br>
            Image Link:
            <input type="url" id="image"><br>
        </div>
        <div class="survey">
            Slide the bar Left(Agree) and Right(Disagrre) along the 5 points as needed. [Middle is Neutral]. <br><br>
            1==============
            <input type="range" id="q1" min="1" max="5"> <br>
            2==============
            <input type="range" id="q2" min="1" max="5"> <br>
            3==============
            <input type="range" id="q3" min="1" max="5"> <br>
            4==============
            <input type="range" id="q4" min="1" max="5"> <br>
            5==============
            <input type="range" id="q5" min="1" max="5"> <br>
            6==============
            <input type="range" id="q6" min="1" max="5"> <br>
            7==============
            <input type="range" id="q7" min="1" max="5"> <br>
            8==============
            <input type="range" id="q8" min="1" max="5"> <br>
            9==============
            <input type="range" id="q9" min="1" max="5"> <br>
            10=============
            <input type="range" id="q10" min="1" max="5"> <br>
            <!-- can be created dinamically from array through loop then referanced with i? -->
        </div>
    </form>
    <button id="submit" onclick="sendData()">Submit</button>
    <a href="./api/friends" target="_blank">Friends API</a>

    <div id="modal-overlay"></div>

    <script>

        let userInputs;

        function sendData() {
            event.preventDefault();
            userInputs = {
                "name": $("#username").val().trim().toString(),
                "photo": $("#image").val().trim().toString(),
                "scores": [
                    parseInt($("#q1").val()),
                    parseInt($("#q2").val()),
                    parseInt($("#q3").val()),
                    parseInt($("#q4").val()),
                    parseInt($("#q5").val()),
                    parseInt($("#q6").val()),
                    parseInt($("#q7").val()),
                    parseInt($("#q8").val()),
                    parseInt($("#q9").val()),
                    parseInt($("#q10").val())
                ]
            }

            console.log(`userInput-on-survey: ${JSON.stringify(userInputs)}`);

            displayResult()

            $.post("/api/friends", userInputs, function (data) {
                if (data) {
                    alert(`Survey Recieved. Please wait while we calculate your results.`);
                } else {
                    alert(`Please Provide Valid Inputs.`)
                }
            });
            
            // reset page to empty inputs?
        }

        function displayResult() {
            $.ajax({ url: "/api/friends", method: "GET" })
            .then(function (arrayData) {
                let closestFriend = compare(arrayData);
                console.log(JSON.stringify(closestFriend));
                const modal = $("<div id='modal'>");
                let name = $(`<h2>${closestFriend.name}</h2>`);
                let img = $(`<img src="${closestFriend.photo}" alt="Your New Best Friend">`)
                modal.append(name, img);
                $("#modal-overlay").append(modal);
            });
        }

        function compare(array) {
            let friends = [];
            array.forEach(e => {
                let diff = 0;
                for (i = 0; i < 10; i++) {
                    diff += Math.abs(userInputs.scores[i] - parseInt(e.scores[i]));
                }
                friends.push(diff);
            });
            for (k = 0; k < 50; k++) {
                for (j = 0; j < friends.length; j++) {
                    if (friends[j] == k) {
                        return array[j]
                    }
                }
            }

            return { name: "Error", image: "https://cdn.shopify.com/s/files/1/0322/6897/files/404-permalink.png?432866230176278629", scores: [404] }

            // Display as MODAL POP UP (name and picture)
        }

    </script>
    
</body>

</html>